!function(ba,aS,aT){var aF={short_name:"ander"};function be(){return bc.short_name?a7+"//"+bc.short_name+"."+ai.DOMAIN:ai.REMOTE}function a5(){function a(){for(var e;e=aN.shift();){var c=e.url,d=new b(e.title,{dir:"auto",icon:e.iconUrl,body:e.body});try{d.onclick=function(){ba.focus(),a6.href=c,d.close()}}catch(f){}setTimeout(function(){d.close&&d.close()},8000)}}var b=ba.Notification;"Notification" in ba&&"denied"!==b.permission&&("granted"===b.permission&&a(),b.requestPermission(function(c){"granted"===c&&a()}))}function aU(){return 0==a3.data.user_id}function aZ(a){ai.theme=a,"none"!=a&&aY.injectStylesheet(ai.STATIC_URL+"/styles/embed"+(a?"."+a+".css?"+aE[a]:"."+short_name)+".css")}var aY={},bb=aS.getElementsByTagName("head")[0]||aS.getElementsByTagName("body")[0];if(aY.extend=function(c,a){for(var b in a){c[b]=a[b]}return c},aY.injectScript=function(b,c){var d=aS.createElement("script"),e=aS.head||aS.getElementsByTagName("head")[0]||aS.documentElement;d.type="text/javascript",d.src=b,d.async="async",d.charset="utf-8",c&&(d.onload=d.onreadystatechange=function(g,f){var h=f||!d.readyState||/loaded|complete/.test(d.readyState);h&&(d.onload=d.onreadystatechange=null,e&&d.parentNode&&e.removeChild(d),d=aT,f||c.call(ba))}),e.insertBefore(d,e.firstChild)},aY.injectStylesheet=function(b){var a=aS.createElement("link");a.type="text/css",a.rel="stylesheet",a.href=b,bb.appendChild(a)},aY.injectStyle=function(b){var a=aS.createElement("style");return a.type="text/css",bb.appendChild(a),b=b.replace(/\}/g,"}\n"),a.styleSheet?a.styleSheet.cssText=b:a.appendChild(aS.createTextNode(b)),a},aY.getCookie=function(g){for(var b,c,f,k=" "+g+"=",j=aS.cookie.split(";"),h=0;h<j.length;h++){if(b=" "+j[h],c=b.indexOf(k),c>=0&&c+k.length==(f=b.indexOf("=")+1)){return decodeURIComponent(b.substring(f,b.length).replace(/\+/g,""))}}return aT},aY.param=function(d){var c=[];for(var b in d){d[b]!=aT&&c.push(b+"="+encodeURIComponent(d[b]))}return c.join("&")},aY.cssProperty=function(g,d){var b=(aS.body||aS.documentElement).style;if("undefined"==typeof b){return !1}if("string"==typeof b[g]){return d?g:!0}for(var c=["Moz","Webkit","ms"],g=g.charAt(0).toUpperCase()+g.substr(1),f=0;f<c.length;f++){if("string"==typeof b[c[f]+g]){return d?c[f]+g:!0}}},!ba.DUOSHUO){for(var a1 in Object.prototype){return alert("Object.prototype 不为空，请不要给 Object.prototype 设置方法")}var bc,aR,aX=ba.JSON,a6=ba.location,a9=ba.XMLHttpRequest,a0=aX&&aX.stringify&&ba.localStorage,aQ=ba.navigator.userAgent,a7="https:"==aS.location.protocol?"https:":"http:",bd=0,aN=[],bf=aR=function(){function f(a){return c[a]||"&amp;"}var c={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},d=/&(?!\w+;)|[<>"'`]/g,b=/[&<>"'`]/;return function(a){return null==a||a===!1?"":b.test(a)?a.replace(d,f):a}}(),a2=function(b){if(b.match(/^(http|https):/)){return b}var a=aS.createElement("a");return a.href=b,am.hrefNormalized?a.href:a.getAttribute("href",4)},aP=function(a){return function(){return a}},aO=function(){for(var c={},a=0;a<arguments.length;a++){arguments[a]&&aY.extend(c,arguments[a])}var b=aY.param(c);return b?"?"+b:""},ag=function(){var a=aY.getCookie("duoshuo_token");return a?{jwt:a}:bc.remote_auth?{short_name:bc.short_name,remote_auth:bc.remote_auth}:aT},aV=function(){if(!bc&&(bc=aF)){if(!bc.short_name||"your_duoshuo_short_name"===bc.short_name){return bc=aT}aH.trigger("queryDefined")}return bc},aC=function(a){return a&&a.error&&a.warn?a:{error:function(){},log:function(){},warn:function(){}}}(ba.console),ai=ba.DUOSHUO={sourceName:{weibo:"新浪微博",qq:"QQ",qzone:"QQ空间",qqt:"腾讯微博",renren:"人人网",douban:"豆瓣网",kaixin:"开心网",sohu:"搜狐微博",baidu:"百度",google:"谷歌",wechat:"微信",weixin:"微信",facebook:"Facebook",twitter:"Twitter",linkedin:"Linkedin"},serviceNames:{weibo:"微博",qq:"QQ",douban:"豆瓣",renren:"人人",kaixin:"开心",baidu:"百度",google:"谷歌",wechat:"微信",weixin:"微信",facebook:"Facebook",twitter:"Twitter",linkedin:"Linkedin"},parseDate:function(a){return a.parse("2011-10-28T00:00:00+08:00")&&function(b){return new a(b)}||a.parse("2011/10/28T00:00:00+0800")&&function(b){return new a(b.replace(/-/g,"/").replace(/:(\d\d)$/,"$1"))}||a.parse("2011/10/28 00:00:00+0800")&&function(b){return new a(b.replace(/-/g,"/").replace(/:(\d\d)$/,"$1").replace("T"," "))}||function(b){return new a(b)}}(Date),fullTime:function(b){var a=ai.parseDate(b);return a.getFullYear()+"年"+(a.getMonth()+1)+"月"+a.getDate()+"日 "+a.toLocaleTimeString()},elapsedTime:function(f){var c=ai.parseDate(f),d=new Date,b=(d-bd-c)/1000;return 10>b?"刚刚":60>b?Math.round(b)+"秒前":3600>b?Math.round(b/60)+"分钟前":86400>b?Math.round(b/3600)+"小时前":(d.getFullYear()==c.getFullYear()?"":c.getFullYear()+"年")+(c.getMonth()+1)+"月"+c.getDate()+"日"},compileStyle:function(f){var c="",d={};if(d.textbox="#ds-thread #ds-reset .ds-replybox .ds-textarea-wrapper",!f){return c}for(var b in f){c+=d[b]+"{"+f[b]+"}\n"}return c},init:function(b,a){b&&!an[b]&&(an[b]=a||{type:"EmbedThread"}),ai.initView&&ai.initView()}},a4=aS.all,am=ai.support=function(){var d=aS.createElement("div");d.innerHTML='<a href="/a" style="opacity:.55;">a</a><input type="checkbox"/>';var b=d.getElementsByTagName("a")[0],c=d.getElementsByTagName("input")[0],e={placeholder:"placeholder" in c,touch:"ontouchstart" in ba||"onmsgesturechange" in ba,opacity:/^0.55$/.test(b.style.opacity),hrefNormalized:"/a"===b.getAttribute("href"),iOS:aQ.match(/ \((iPad|iPhone|iPod);( U;)? CPU( iPhone)? OS /),android:aQ.match(/ \(Linux; U; Android /)};return e.ie6=!a9&&"undefined"==typeof d.style.maxHeight,e.authInWin=ba.postMessage&&ba.screen.width>800&&!e.iOS&&!e.android&&a6.origin,e}(),an=ai.selectors={".adr-comment":{type:"EmbedThread"},".ds-recent-comments":{type:"RecentComments"},".ds-recent-visitors":{type:"RecentVisitors"},".ds-top-users":{type:"TopUsers"},".ds-top-threads":{type:"TopThreads"},".ds-login":{type:"LoginWidget"},".ds-thread-count":{type:"ThreadCount"},".ds-share":{type:"ShareWidget"}},aA=ai.openDialog=function(a){return ai.dialog!==aT&&ai.dialog.el.remove(),ai.dialog=new ax.Dialog(aW.dialog(a)).open()},aq=ai.smilies={};ai.require=function(){function a(d){var c=af[d]?"?"+af[d]+".js":"";return ai.STATIC_URL+"/libs/"+d+".js"+c}var b={mzadxN:"undefined"!=typeof mzadxN};return"undefined"!=typeof jQuery&&jQuery.fn.jquery>="1.5"&&(b["embed.compat"]=!0,ai.jQuery=ba.jQuery),function(g,c){if("string"==typeof g){b[g]?c():aY.injectScript(a(g),function(){b[g]=!0,c()})}else{if("object"==typeof g){var d,f=!0;for(d=0;d<g.length;d++){(function(e){b[g[d]]||(f=!1,aY.injectScript(a(e),function(){b[e]=!0;for(var h=0;h<g.length;h++){if(!b[g[h]]){return}}c()}))})(g[d])}f&&c()}}}}();for(var ao=0,av=["EmbedThread","RecentComments","RecentVisitors","TopUsers","TopThreads","LoginWidget","ThreadCount"];ao<av.length;ao++){ai[av[ao]]=function(a){return function(b,c){c=c||{},c.type=a,b&&!an[b]&&(an[b]=c),ai.initSelector&&ai.initSelector(b,c)}}(av[ao]),ai["create"+av[ao]]=function(a){return function(d,b){var c=aS.createElement(d);for(var e in b){c.setAttribute("data-"+e,b[e])}return ai[a](c),c}}(av[ao])}ai.RecentCommentsWidget=ai.RecentComments;var aj=ai.API={ajax:function(p,z,j,a,b){function q(g){var d=g.getResponseHeader("Date");d&&(bd=new Date-new Date(d))}function f(r,m,n){var g,h,u,d=m;if(r>=200&&300>r||304===r){if(304===r){d="notmodified",u=!0}else{try{g=aX.parse(n),d="success",u=!0}catch(v){d="parsererror",h=v}}}else{h=d,(!d||r)&&(d="error",0>r&&(r=0));try{g=aX.parse(n)}catch(v){d="parsererror",h=v}}u?a&&a(g):"parseerror"===d?aC.error("解析错误: "+n):(aC.error("出错啦("+g.code+"): "+g.errorMessage),b&&b(g),g.errorTrace&&aC.error(g.errorTrace)),q(c)}var x=aY.getCookie("duoshuo_token");j=j||{},j.v=ai.version,x?j.jwt=x:bc.remote_auth&&(j.remote_auth=bc.remote_auth);var k=a9&&aX&&aX.parse;if(k){var c=new a9,w=!!c&&"withCredentials" in c;if(w){var o;return c.open(p,be()+"/api/"+z+".json"+("GET"==p?"?"+aY.param(j):""),!0),c.withCredentials=!0,c.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),c.send("GET"==p?null:aY.param(j)),o=function(u,l){var g,h,m,A;try{if(o&&(l||4===c.readyState)){if(o=aT,l){4!==c.readyState&&c.abort()}else{g=c.status,m=c.getAllResponseHeaders();try{A=c.responseText}catch(u){}try{h=c.statusText}catch(y){h=""}}}}catch(v){l||f(-1,v)}A&&f(g,h,A,m)},void (4===c.readyState?o():c.onreadystatechange=o)}}"GET"!=p&&(j._method="POST");var s="cb_"+Math.round(1000000*Math.random());aj[s]=function(d){switch(d.code){case 0:a&&a(d);break;default:b&&b(d),aC.error("出错啦("+d.code+"): "+d.errorMessage),d.errorTrace&&aC.error(d.errorTrace)}},j.callback="DUOSHUO.API['"+s+"']",aY.injectScript(be()+"/api/"+z+".jsonp?"+aY.param(j))},get:function(f,c,d,b){return this.ajax("GET",f,c,d,b)},post:function(f,c,d,b){return this.ajax("POST",f,c,d,b)}},ap=ai.ws={messages:[],send:function(c){if(!("WebSocket" in ba&&aX)){return !1}var b=this;if(b.messages.push(aX.stringify(c)),!b.webSocket){var d="https:"===aS.location.protocol?"wss://ws.duoshuo.com:8202/":"ws://ws.duoshuo.com:8201/",e=b.webSocket=new WebSocket(d);e.onopen=function(){var f,a=1===e.readyState;if(a){for(;f=b.messages.shift();){e.send(f)}}},e.onmessage=function(j){try{var g=aX.parse(j.data)}catch(h){return}switch(g.type){case"post":for(var f,i=0;i<ai.pagelets.length;i++){f=ai.pagelets[i],f.threadId==g.thread_id&&f.onMessage(g)}break;case"notification":aN.push(g),a5()}},ba.addEventListener("beforeunload",function(){e.close()})}b.webSocket.onopen()}};ai.DOMAIN="duoshuo.com",ai.STATIC_URL=a7+"//static.duoshuo.com",ai.REMOTE=a7+"//duoshuo.com",ai.version="16.2.24";var aE={"default":"349d9313",dark:"b9ab6243",bluebox:"17249850",newhua:"176e2fae",justflat:"2ea405f8"},af={"embed.compat":"24f8ca3f",smilies:"921e8eda"},aB={post:"发布",posting:"正在发布",settings:"设置",reply:"回复",like:"顶",repost:"转发",report:"举报","delete":"删除",reply_to:"回复 ",reposts:"转发",comments:"评论",floor:"楼",latest:"最新",earliest:"最早",hottest:"最热",share_to:"分享到:",leave_a_message:"说点什么吧…",no_comments_yet:"还没有评论，沙发等你来抢",repost_reason:"请输入转发理由",hot_posts_title:"被顶起来的评论",comments_zero:"暂无评论",comments_one:"1条评论",comments_multiple:"{num}条评论",reposts_zero:"暂无转发",reposts_one:"1条转发",reposts_multiple:"{num}条转发",weibo_reposts_zero:"暂无新浪微博",weibo_reposts_one:"1条新浪微博",weibo_reposts_multiple:"{num}条新浪微博",qqt_reposts_zero:"暂无腾讯微博",qqt_reposts_one:"1条腾讯微博",qqt_reposts_multiple:"{num}条腾讯微博"},aM={get:function(a){return a0?a0[a]:void 0},save:function(c,a){if(a0){try{a0.removeItem(c),a0[c]=aX.stringify(a),a0.removeItem(c+":timestamp"),a0[c+":timestamp"]=Math.floor((new Date-bd)/1000)}catch(b){}}}},ad=ai.loadRequire=function(a){if(a.visitor&&(!a3.data&&a.visitor.user_id&&ba.Notification&&ap.send({logged_user_id:a.visitor.user_id}),a3.reset(a.visitor)),a.site&&(aK.reset(a.site),aM.save("ds_site_"+bc.short_name,a.site)),!ai.theme&&aK.data.theme&&aZ(aK.data.theme),a.lang&&(aY.extend(aB,a.lang),aM.save("ds_lang_"+bc.short_name,a.lang)),a.stylesheets){for(var b=0;b<a.stylesheets.length;b++){aY.injectStylesheet(a.stylesheets[b])}}if(a.nonce&&(ai.nonce=a.nonce),a.style&&aY.injectStyle((a.style||"")+ai.compileStyle(bc.component_style)),a.unread&&aJ.reset(a.unread),a.warnings){for(var b=0;b<a.warnings.length;b++){aC.warn(a.warnings[b])}}},aw=0,aD=ai.Class=function(){};aD.extend=function(f){function c(){!aw&&this.init&&this.init.apply(this,arguments)}aw=1;var d=new this;aw=0;for(var b in f){d[b]=f[b]}return c.prototype=d,c.prototype.constructor=c,c.extend=arguments.callee,c};var au=ai.Event=aD.extend({on:function(d,c){var b=this.handlers||(this.handlers={});return b[d]===aT&&(b[d]=[]),b[d].push(c),this},trigger:function(f,c){var d=(this.handlers||(this.handlers={}))[f];if(d){for(var b=0;b<d.length&&d[b].call(this,c)!==!1;b++){}}return this}}),al=ai.Widget=au.extend({init:function(b,a){this.el=b,this.options=a||{},this.render()},render:function(){},reset:function(){},load:function(b){switch(b.code){case 0:ad(b);var a=this.prepare(b);a.options=aY.extend(this.options,b.options),this.onload(a);break;default:this.onError(b)}},onload:function(a){this.el.html(aW[this.tmpl](a))},prepare:function(a){return a},onMessage:function(){},onError:function(a){aC.error("出错啦("+a.code+"): "+a.errorMessage),a.errorTrace&&aC.error(a.errorTrace)}}),ae=ai.Model=au.extend({init:function(a){this.data=a},reset:function(a){this.data=a,this.trigger("reset")},remove:function(a){this.data.splice(a,1),this.trigger("reset")},set:function(d,c){if(c===aT){for(var b in d){this.data[b]=d[b]}}else{this.data[d]=c}return this.trigger("reset"),this},toJSON:function(){return aY.extend({},this.data)}}),aL=ae.extend({toJSON:function(){return aY.extend({},this.data)}}),az=ae.extend({toJSON:function(){var a=aY.extend({},this.data);return a.theAuthor=aG[this.data.author_id]&&aG[this.data.author_id].data||this.data.author,a.parents=this.data.parents||[],a}}),ab=ae.extend({toJSON:function(){return aY.extend({},this.data)}}),ay=function(a){this.model=a};ay.prototype.set=function(b){for(var a in b){b[a]&&(this[a]?this[a].set(b[a]):this[a]=new this.model(b[a]))}},ay.prototype.get=function(c){for(var a=0,b=[];a<c.length;a++){b[a]=this[c[a]]}return b},ay.prototype.getJSON=function(c){for(var a=0,b=[];a<c.length;a++){this[c[a]]&&b.push(this[c[a]].toJSON())}return b};var aa={userUrl:function(a){return a.url},avatarUrl:function(a){return a.avatar_url||aK.data.default_avatar_url},loginUrl:function(b,a){return a||(a={}),bc.sso&&bc.sso.login&&(a.sso=1,a.redirect_uri=bc.sso.login),be()+"/login/"+b+"/"+aO(a)},bindUrl:function(a){return be()+"/bind/"+a+"/"+aO(bc.sso&&bc.sso.login?{sso:1,redirect_uri:bc.sso.login}:null,ag())},logoutUrl:function(){return be()+"/logout/"+aO(bc.sso&&bc.sso.logout?{sso:1,redirect_uri:bc.sso.logout}:null)}},ac=["weixin","weibo","qq","renren"],ar=["douban","kaixin","baidu","google"],aW=ai.templates={userAnchor:function(a){return a.url?'<a rel="nofollow author" target="_blank" href="'+bf(a.url)+'">'+bf(a.name)+"</a>":bf(a.name)},avatarImg:function(b,a){return'<img src="'+bf(aa.avatarUrl(b,a))+'" alt="'+bf(b.name)+'"'+(a?' style="width:'+a+"px;height:"+a+'px"':"")+"/>"},avatar:function(d,b){var c=aW.avatarImg(d,b),a=aa.userUrl(d);return a?'<a rel="nofollow author" target="_blank" href="'+bf(a)+'" '+(d.user_id?" onclick=\"this.href='"+be()+"/user-url/?user_id="+d.user_id+"';\"":"")+' title="'+bf(d.name)+'">'+c+"</a>":c},timeText:function(a){return a?'<span class="ds-time" datetime="'+a+'" title="'+ai.fullTime(a)+'">'+ai.elapsedTime(a)+"</span>":""},timeAnchor:function(b,a){return b?'<a href="'+a+'" target="_blank" rel="nofollow" class="ds-time" datetime="'+b+'" title="'+ai.fullTime(b)+'">'+ai.elapsedTime(b)+"</a>":""},serviceIcon:function(b,a){return'<a href="javascript:void(0)" class="ds-service-icon'+(a?"-grey":"")+" ds-"+b+'" data-service="'+b+'" title="'+ai.sourceName[b]+'"></a>'},poweredBy:function(a){return""},indicator:aP('<div id="ds-indicator"></div>'),waitingImg:aP('<div id="ds-waiting"></div>'),loginItem:function(c,a){var b=aa[a?"bindUrl":"loginUrl"](c);return'<li>    <a href="'+b+'" rel="nofollow" class="ds-service-link ds-'+c+'">'+ai.serviceNames[c]+(a3.data.social_uid[c]?' <span class="ds-icon ds-icon-ok"></span>':"")+"</a></li>"}},a8=function(c){var a=[];for(var b in c){a.push('<input type="hidden" name="'+b+'" value="'+bf(c[b])+'" />')}return a.join("\n")};aW.commentList=function(h){var d="",f=h.list;if(f){for(var b,c=-1,g=f.length-1;g>c;){b=f[c+=1],d+='<li class="ds-comment',h.options.show_avatars&&(d+=" ds-show-avatars"),d+='" data-post-id="'+b.post_id+'">',h.options.show_avatars&&(d+='<div class="ds-avatar">'+aW.avatar(b.theAuthor,h.options.avatar_size)+"</div>"),d+='<div class="ds-meta">'+aW.userAnchor(b.theAuthor),h.options.show_time&&(d+=aW.timeText(b.created_at)),d+="</div>",d+=h.options.show_title?'<div class="ds-thread-title">在 <a href="'+aR(b.thread.url)+'#comments">'+aR(b.thread.title)+'</a> 中评论</div><div class="ds-excerpt">'+b.message+"</div>":'<a class="ds-excerpt" title="'+b.thread.title+' 中的评论" href="'+aR(b.thread.url)+'#comments">'+b.message+"</a>",d+="</li>"}}return d},aW.ctxPost=function(b){var a="";return b.post&&(a+='<li class="ds-ctx-entry"',b.hidden&&(a+=' style="display:none"'),a+=' data-post-id="'+b.post.post_id+'"><div class="ds-avatar">'+aW.avatar(b.post.theAuthor||b.post.author)+'</div><div class="ds-ctx-body"><div class="ds-ctx-head">'+aW.userAnchor(b.post.theAuthor||b.post.author)+aW.timeAnchor(b.post.created_at,b.post.url),b.index>=0&&(a+='<div class="ds-ctx-nth" title="'+ai.fullTime(b.post.created_at)+'">'+(b.index+1)+aB.floor+"</div>"),a+='</div><div class="ds-ctx-content">'+b.post.message,b.index>=0&&(a+='　　　　　　　<div class="ds-comment-actions',b.post.vote>0&&(a+=" ds-post-liked"),a+='">'+aW.likePost(b.post)+'<a class="ds-post-repost" href="javascript:void(0);"><span class="ds-icon ds-icon-share"></span>'+aB.repost+'</a><a class="ds-post-reply" href="javascript:void(0);"><span class="ds-icon ds-icon-reply"></span>'+aB.reply+"</a></div>"),a+="</div></div></li>"),a},aW["dialog-anonymous"]=function(h){var d='<h2>社交帐号登录</h2><div class="ds-icons-32">',f=h.services;if(f){for(var b,c=-1,g=f.length-1;g>c;){b=f[c+=1],d+='<a class="ds-'+b+'" href="'+aa.loginUrl(b)+'">'+ai.sourceName[b]+"</a>"}}return d+="</div>",h.options.deny_anonymous||(d+='<h2>作为游客留言</h2><form><div class="ds-control-group"><input type="text" name="author_name" id="ds-dialog-name" value="'+aR(a3.data.name)+'" required /><label for="ds-dialog-name">名字(必填)</label></div>',h.options.require_guest_email&&(d+='<div class="ds-control-group"><input type="email" name="author_email" id="ds-dialog-email" value="'+aR(a3.data.email)+'" required /><label for="ds-dialog-email">邮箱(必填)</label></div>'),h.options.require_guest_url&&(d+='<div class="ds-control-group"><input type="url" name="author_url" id="ds-dialog-url" placeholder="http://" value="'+aR(a3.data.url)+'" /><label for="ds-dialog-url">网址(可选)</label></div>'),d+='<button type="submit">发布</button></form>'),d},aW["dialog-ask-for-auth"]=function(){var a='<h2>社交帐号登录</h2><ul class="ds-service-list">'+aW.serviceList(ac)+'</ul><ul class="ds-service-list ds-additional-services">'+aW.serviceList(ar)+"</ul>";return a},aW["dialog-bind-more"]=function(){var a='<h2>绑定更多帐号</h2><ul class="ds-service-list">'+aW.serviceBindList(ac)+'</ul><ul class="ds-service-list ds-additional-services">'+aW.serviceBindList(ar)+'</ul><div style="clear:both"></div>';return a},aW["dialog-qrcode"]=function(b){var a='<h2>微信扫一扫，分享到朋友圈</h2><div class="ds-share-qrcode" style="text-align:center;"><img src="'+b.qrcode_url+'" alt="'+b.url+'"></div>';return a},aW["dialog-reposts"]=function(b){var a='<h2>转发到微博</h2><div class="ds-quote"><strong>@'+aR(b.post.theAuthor.name)+"</strong>: "+b.post.message+"</div><form>"+a8({post_id:b.post.post_id})+'<div class="ds-textarea-wrapper"><textarea name="message" title="Ctrl+Enter快捷提交" placeholder="'+aR(aB.repost_reason)+'">'+aR(b.repostMessage)+'</textarea><pre class="ds-hidden-text"></pre>';return a+='</div><div class="ds-actions">',b.service?a+=a8({"service[]":b.service}):(a+='<label><input type="checkbox" name="service[]" value="weibo"',a3.data.social_uid.weibo&&(a+=' checked="checked"'),a+=' /><span class="ds-service-icon ds-weibo"></span>新浪微博</label><label><input type="checkbox" name="service[]" value="qqt"',a3.data.social_uid.qq&&(a+=' checked="checked"'),a+=' /><span class="ds-service-icon ds-qqt"></span>腾讯微博</label>'),a+='<button type="submit">'+aB.repost+"</button></div></form>"},aW.dialog=function(b){var a='<div class="ds-dialog"><div class="ds-dialog-inner ds-rounded"><div class="ds-dialog-body">'+b+'</div><div class="ds-dialog-footer"><span>Ander博客评论框</span></div><a class="ds-dialog-close" href="javascript:void(0)" title="关闭"></a></div></div>';return a},aW.hotPosts=function(h){var d='<div class="ds-header ds-gradient-bg">'+aR(aB.hot_posts_title)+"</div><ul>",f=h.list;if(f){for(var b,c=-1,g=f.length-1;g>c;){b=f[c+=1],d+=aW.post({post:b,options:h.options})}}return d+="</ul>"},aW.likePost=function(b){var a='<a class="ds-post-likes" href="javascript:void(0);"><span class="ds-icon ds-icon-like"></span>'+aB.like;return b.likes>0&&(a+="("+b.likes+")"),a+="</a>"},aW.likeTooltip=function(c){var a='<div class="ds-like-tooltip ds-rounded"><p>很高兴你能喜欢，分享一下吧：</p><ul>';for(var b in c.services){a+='<li><a class="ds-share-to-'+b+" ds-service-link ds-"+b+'" href="'+be()+"/share-proxy/?"+aY.param({service:b,thread_id:c.thread_id})+'">'+c.services[b]+"</a></li>"}return a+='</ul><p class="ds-like-tooltip-footer"><a class="ds-like-tooltip-close">算了</a></p></div>'},aW.loginButtons=function(){var a='<div class="ds-login-buttons"><p>社交帐号登录:</p><div class="ds-social-links"><ul class="ds-service-list">'+aW.serviceList(ac)+'<li><a class="ds-more-services" href="javascript:void(0)">更多»</a></li></ul><ul class="ds-service-list ds-additional-services">'+aW.serviceList(ar)+"</ul></div></div>";return a},aW.loginWidget=function(h){var d='<div class="ds-icons-32">',f=h;if(f){for(var b,c=-1,g=f.length-1;g>c;){b=f[c+=1],d+='<a class="ds-'+b+'" href="'+aa.loginUrl(b)+'">'+ai.sourceName[b]+"</a>"}}return d+="</div>"},aW.meta=function(b){var a='<div class="ds-meta"><a href="javascript:void(0)" class="ds-like-thread-button ds-rounded';return b.user_vote>0&&(a+=" ds-thread-liked"),a+='"><span class="ds-icon ds-icon-heart"></span> <span class="ds-thread-like-text">',a+=b.user_vote>0?"已喜欢":"喜欢",a+='</span><span class="ds-thread-cancel-like">取消喜欢</span></a><span class="ds-like-panel"></span></div>'},aW.notify=function(b){var a='<div id="ds-reset">&nbsp;<ul class="ds-notify-unread"><li';return b.comments||(a+=' style="display:none;"'),a+='><a data-type="unread-comments" href="javascript:void(0);">你有'+b.comments+"条新回复</a></li><li",b.notifications||(a+=' style="display:none;"'),a+='><a data-type="unread-notifications" href="javascript:void(0);">你有'+b.notifications+"条系统消息</a></li></ul></div>"},aW.post=function(k){var u="",v=k.post,j=k.options,a=v.author;if(u+='<li class="ds-post" data-post-id="'+v.post_id+'"><div class="ds-post-self" data-post-id="'+v.post_id+'" data-thread-id="'+v.thread_id+'" data-root-id="'+v.root_id+'" data-source="'+v.source+'"><div class="ds-avatar"',a.user_id&&(u+=' data-user-id="'+a.user_id+'"'),u+=">"+aW.avatar(a),ai.sourceName[v.source]&&(u+=aW.serviceIcon(v.source)),u+='</div><div class="ds-comment-body"><div class="ds-comment-header">',a.url?(u+='<a class="ds-user-name ds-highlight" data-qqt-account="'+(a.qqt_account||"")+'" href="'+aR(a.url)+'" ',a.user_id&&(u+=" onclick=\"this.href='"+be()+"/user-url/?user_id="+a.user_id+"';\""),u+=' rel="nofollow" target="_blank"',a.user_id&&(u+=' data-user-id="'+a.user_id+'"'),u+=">"+aR(a.name)+"</a>"):(u+='<span class="ds-user-name"',a.user_id&&(u+=' data-user-id="'+a.user_id+'"'),u+=' data-qqt-account="'+(a.qqt_account||"")+'">'+aR(a.name)+"</span>"),u+="</div>",1==j.max_depth&&j.show_context&&v.parents.length){u+='<ol id="ds-ctx">';var g=aI.getJSON(v.parents);if(g){for(var f,m=-1,h=g.length-1;h>m;){f=g[m+=1],1==m&&v.parents.length>2&&(u+='<li class="ds-ctx-entry"><a href="javascript:void(0);" class="ds-expand">还有'+(v.parents.length-2)+"条评论</a></li>"),u+=aW.ctxPost({post:f,index:m,hidden:m&&m<v.parents.length-1})}}u+="</ol>"}if(u+="<p>",v.parents.length>=j.max_depth&&(!j.show_context||j.max_depth>1)&&v.parent_id&&aI[v.parent_id]&&(u+='<a class="ds-comment-context" data-post-id="'+v.post_id+'" data-parent-id="'+v.parent_id+'">'+aB.reply_to+aR(aI[v.parent_id].toJSON().author.name)+": </a>"),u+=v.message+'</p><div class="ds-comment-footer ds-comment-actions',v.vote>0&&(u+=" ds-post-liked"),u+='">',u+=v.url?aW.timeAnchor(v.created_at,v.url):aW.timeText(v.created_at),"duoshuo"==v.source?(u+='<a class="ds-post-reply" href="javascript:void(0);"><span class="ds-icon ds-icon-reply"></span>'+aB.reply+"</a>"+aW.likePost(v)+'<a class="ds-post-repost" href="javascript:void(0);"><span class="ds-icon ds-icon-share"></span>'+aB.repost+'</a><a class="ds-post-report" href="javascript:void(0);"><span class="ds-icon ds-icon-report"></span>'+aB.report+"</a>",v.privileges["delete"]&&(u+='<a class="ds-post-delete" href="javascript:void(0);"><span class="ds-icon ds-icon-delete"></span>'+aB["delete"]+"</a>")):("qqt"==v.source||"weibo"==v.source)&&(u+='<a class="ds-weibo-comments" href="javascript:void(0);">'+aB.comments,v.type.match(/\-comment$/)||(u+='(<span class="ds-count">'+v.comments+"</span>)"),u+='</a><a class="ds-weibo-reposts" href="javascript:void(0);">'+aB.reposts,v.type.match(/\-comment$/)||(u+='(<span class="ds-count">'+v.reposts+"</span>)"),u+="</a>"),u+="</div></div></div>",j.max_depth>1&&(v.childrenArray||v.children)&&"weibo"!=v.source&&"qqt"!=v.source){u+='<ul class="ds-children">';var q=aI.getJSON(v.childrenArray||v.children);if(q){for(var v,m=-1,b=q.length-1;b>m;){v=q[m+=1],u+=aW.post({post:v,options:j})}}u+="</ul>"}return u+="</li>"},aW.postListHead=function(b){var a='<div class="ds-comments-info"><div class="ds-sort"><a class="ds-order-desc">'+aB.latest+'</a><a class="ds-order-asc">'+aB.earliest+'</a><a class="ds-order-hot">'+aB.hottest+'</a></div><ul class="ds-comments-tabs"><li class="ds-tab"><a class="ds-comments-tab-duoshuo ds-current" href="javascript:void(0);"></a></li>';return b.options.show_reposts&&b.thread.reposts&&(a+='<li class="ds-tab"><a class="ds-comments-tab-repost" href="javascript:void(0);"></a></li>'),a+=" ",b.options.show_weibo&&b.thread.weibo_reposts&&(a+='<li class="ds-tab"><a class="ds-comments-tab-weibo" href="javascript:void(0);"></a></li>'),a+=" ",b.options.show_qqt&&b.thread.qqt_reposts&&(a+='<li class="ds-tab"><a class="ds-comments-tab-qqt" href="javascript:void(0);"></a></li>'),a+="</ul></div>"},aW.recentVisitors=function(h){var d="",f=h.response;if(f){for(var b,c=-1,g=f.length-1;g>c;){b=f[c+=1],d+='<div class="ds-avatar">'+aW.avatar(b,h.options.avatar_size)+"</div>"}}return d},aW["related-read"]=function(j){var p="";if(j&&j.length){p+='<article class="ds-reads-expand"><header>头条推荐</header><section> ';var q=j;if(q){for(var m,h=-1,b=q.length-1;b>h;){if(m=q[h+=1],p+=' <a href="'+m.url+'" class="ds-reads-item"> ',3==m.imgs.length){p+=" <h2>"+m.title+'</h2> <div class="ds-reads-pics"> <ul> ';var f=m.imgs;if(f){for(var c,k=-1,g=f.length-1;g>k;){c=f[k+=1],p+=' <li> <div class="ds-reads-dumb"></div> <div class="ds-reads-pic-wrap" style="background-image:url('+c+');"></div> </li> '}}p+=' </ul> </div> <div class="ds-reads-info"> ',1==m.type&&(p+=' <span class="ds-reads-app-special">打开头条阅读</span> '),p+=' <span class="ds-reads-date" data-date="'+m.timeStamp+'"></span> </div> '}else{p+=' <div class="ds-reads-desc ',m.imgs.length||(p+="ds-reads-only"),p+='"> <div class="ds-reads-title">'+m.title+'</div> <div class="ds-reads-info"> ',1==m.type&&(p+=' <span class="ds-reads-app-special">打开头条阅读</span> '),p+=' <span class="ds-reads-date" data-date="'+m.timeStamp+'"></span> </div> </div> ',m.imgs.length&&(p+=' <div class="ds-reads-pic-right"> <div class="ds-reads-dumb"></div> <div class="ds-reads-pic-wrap" style="background-image:url('+m.imgs[0]+');"> ',m.hasVideo&&(p+=' <div class="ds-reads-vid-info"><span>'+m.videoDuration+"</span></div> "),p+=" </div> </div> "),p+=" "}p+=" </a> "}}p+="</section></article>"}return p},aW.replybox=function(c){var a='<div class="ds-replybox"><a class="ds-avatar"';if(a+=aU()?' href="javascript:void(0);" onclick="return false"':' href="'+ai.REMOTE+"/settings/avatar/"+aO(ag())+'" target="_blank" title="设置头像"',a+=">"+aW.avatarImg(a3.data)+'</a><form method="post">'+a8(c.params)+'<div class="ds-textarea-wrapper ds-rounded-top"><textarea name="message" title="Ctrl+Enter快捷提交" placeholder="'+aR(aB.leave_a_message)+'"></textarea><pre class="ds-hidden-text"></pre>',a+="</div>",a+='<div class="ds-post-toolbar"><div class="ds-post-options ds-gradient-bg"><span class="ds-sync">',!aU()&&a3.data.repostOptions){a+='<input id="ds-sync-checkbox',c.inline&&(a+="-inline"),a+='" type="checkbox" name="repost" ',c.checked&&(a+='checked="checked" '),a+='value="'+c.repostArray.join(",")+'"> <label for="ds-sync-checkbox',c.inline&&(a+="-inline"),a+='">'+aB.share_to+"</label>";for(var b in a3.data.repostOptions){a+=aW.serviceIcon(b,!a3.data.repostOptions[b])}}return a+="</span>",a+="</div>",a+='<button class="ds-post-button" type="submit">'+aR(aB.post)+'</button><div class="ds-toolbar-buttons">',c.options.use_smilies&&(a+='<a class="ds-toolbar-button ds-add-emote" title="插入表情"></a>'),c.options.use_images&&c.options.parse_html_enabled&&(a+='<a class="ds-toolbar-button ds-add-image" title="插入图片"></a>'),a+="</div></div>",a+="</form></div>"},aW.serviceBindList=function(h){var d="",f=h;if(f){for(var b,c=-1,g=f.length-1;g>c;){b=f[c+=1],d+='<li><a href="'+aa.bindUrl(b)+'" rel="nofollow" class="ds-service-link ds-'+b+'">'+ai.serviceNames[b],a3.data.social_uid[b]&&(d+=' <span class="ds-icon ds-icon-ok"></span>'),d+="</a></li>"}}return d},aW.serviceList=function(h){var d="",f=h;if(f){for(var b,c=-1,g=f.length-1;g>c;){b=f[c+=1],d+='<li><a href="'+aa.loginUrl(b)+'" rel="nofollow" class="ds-service-link ds-'+b+'">'+ai.serviceNames[b]+"</a></li>"}}return d},aW.shareWidget=function(h){var d='<div class="ds-share-icons"> <div class="ds-share-icons-inner"> <ul class="ds-share-icons-16"> ',f=h.services;if(f){for(var b,c=-1,g=f.length-1;g>c;){b=f[c+=1],d+=' <li> <a class="ds-'+b+'" href="javascript:void(0);" data-service="'+b+'">'+ai.sourceName[b]+"</a> </li> "}}return d+=' </ul> </div> <div class="ds-share-icons-footer">'+h.copyright+"</div></div>"},aW.smiliesTooltip=function(c){var a='<div id="ds-smilies-tooltip"><ul class="ds-smilies-tabs">';for(var b in c){a+="<li><a>"+b+"</a></li>"}return a+='</ul><div class="ds-smilies-container"></div></div>'},aW.toolbar=function(){var a='<div class="ds-toolbar"><div class="ds-account-control"><span class="ds-icon ds-icon-settings"></span> <span>帐号管理</span><ul><li><a class="ds-bind-more" href="javascript:void(0);" style="border-top: none">绑定更多</a></li><li><a target="_blank" href="'+ai.REMOTE+"/settings/"+aO(ag())+'">'+aR(aB.settings)+'</a></li><li><a rel="nofollow" href="'+aa.logoutUrl()+'" style="border-bottom: none">登出</a></li></ul></div><div class="ds-visitor">';return a+=a3.data.url?'<a class="ds-visitor-name" href="'+aR(a3.data.url)+'" target="_blank">'+aR(a3.data.name)+"</a>":'<span class="ds-visitor-name">'+aR(a3.data.name)+"</span>",a+='<a class="ds-unread-comments-count" href="javascript:void(0);" title="新回复"></a></div></div>'},aW.topThreads=function(h){var d="",f=h.response;if(f){for(var b,c=-1,g=f.length-1;g>c;){b=f[c+=1],d+='<li><a target="_blank" href="'+aR(b.url)+'" title="'+aR(b.title)+'">'+aR(b.title)+"</a></li>"}}return d},aW.topUsers=function(h){var d="",f=h.response;if(f){for(var b,c=-1,g=f.length-1;g>c;){b=f[c+=1],d+='<div class="ds-avatar">'+aW.avatar(b,h.options.avatar_size)+"<h4>"+aR(b.name)+"</h4></div>"}}return d},aW.userInfo=function(c){var a='<a href="'+aR(c.url)+'" onclick="this.href=\''+be()+"/user-url/?user_id="+c.user_id+'\';" class="ds-avatar" target="_blank">'+aW.avatarImg(c)+'</a><a href="'+aR(c.url)+'" onclick="this.href=\''+be()+"/user-url/?user_id="+c.user_id+'\';" class="ds-user-name ds-highlight" target="_blank">'+aR(c.name)+"</a>";for(var b in c.social_uid){a+='<a href="'+ai.REMOTE+"/user-proxy/"+b+"/"+c.social_uid[b]+'/" target="_blank" class="ds-service-icon ds-'+b+'" title="'+ai.sourceName[b]+'"></a>'}return a+='<p class="ds-user-card-meta"><a href="'+ai.REMOTE+"/profile/"+c.user_id+'/" target="_blank"><span class="ds-highlight">'+c.comments+"</span>条评论</a></p>",c.description&&(a+='<p class="ds-user-description">'+aR(c.description)+"</p>"),a};var ax=ai.Views={},ah=(ai.Callbacks={},ai.pagelets=[]),aH=ai.events=new au,aK=ai.site=new ae,a3=ai.visitor=new aL,aJ=ai.unread=new ae,ak=ai.threadPool=new ay(ab),aI=ai.postPool=new ay(az),aG=ai.userPool=new ay(aL);aH.on("queryDefined",function(){var c=bc.short_name;if(bc.theme&&aZ(bc.theme),a0){var a=a0["ds_site_"+c],b=a0["ds_lang_"+c];a&&aK.reset(aX.parse(a)),b&&aY.extend(aB,aX.parse(b))}}),aV(),ai.require("embed.compat",function(){function M(b){b.stopPropagation()}function J(b){(b.ctrlKey&&13==b.which||10==b.which)&&D(this.form).trigger("submit")}function Q(){var b=D(this);b.height(Math.max(54,b.next(".ds-hidden-text").text(this.value).height()+27))}function L(){if(am.authInWin){var b=this.href.match(/\/(login|bind)\/(\w+)\//i);if(b&&ai.serviceNames[b[2]]){return !R(b[2],this.href)}}}function C(){var p,g,b,f,l,x=this,w=0,u=0;aS.selection&&(g=aS.selection.createRange(),g&&g.parentElement()==x&&(f=x.value.length,p=x.value.replace(/\r\n/g,"\n"),b=x.createTextRange(),b.moveToBookmark(g.getBookmark()),l=x.createTextRange(),l.collapse(!1),b.compareEndPoints("StartToEnd",l)>-1?w=u=f:(w=-b.moveStart("character",-f),w+=p.slice(0,w).split("\n").length-1,b.compareEndPoints("EndToEnd",l)>-1?u=f:(u=-b.moveEnd("character",-f),u+=p.slice(0,u).split("\n").length-1)))),D(x).data("ds-range-start",w).data("ds-range-end",u)}function F(b){return am.touch&&b.addClass("ds-touch"),aY.cssProperty("transition")||b.addClass("ds-no-transition"),am.ie6&&b.addClass("ds-ie6"),am.opacity||b.addClass("ds-no-opacity"),b}function P(d){if(!am.placeholder){var b=d.attr("placeholder");d.val(b).focus(function(){this.value===b&&(this.value="")}).blur(function(){""===this.value&&(this.value=b)})}return d}function O(b){if("http://duoshuo.com"===b.origin){switch(b.data.type){case"login":a6.href=b.data.redirectUrl}}}function R(d,f){var b={weibo:[760,600],renren:[420,322],qq:[504,445],weixin:[450,550],google:[600,440]}[d]||[550,400];return ba.open(f+(-1==f.indexOf("?")?"?":"&")+aY.param({origin:a6.origin||"http://"+a6.host}),"_blank","width="+b[0]+",height="+b[1]+",toolbar=no,menubar=no,location=yes")}function q(d){var b=aa[aU()?"loginUrl":"bindUrl"](d);am.authInWin&&R(d,b)||(a6.href=b)}function v(){var b=aA(aW["dialog-ask-for-auth"]({})).el.find(".ds-dialog").css("width","300px");b.find("a.ds-service-link").click(L)}function s(u,g,n,d){function f(){function i(A){if(n&&d){var x=n.options,l=E(n.postList.el,A.response[d],x);"asc"==x.order==("top"==x.formPosition)&&ai.scrollTo(l);var y=n.el.find(".ds-comments-tab-"+d+" span.ds-highlight");y.html(parseInt(y.html())+1)}}return d||b.find("[type=checkbox]:checked")[0]?(aj.post("posts/repost",ai.toJSON(b),i),w.close(),!1):(alert("还没有选发布到哪儿呢"),!1)}function p(){var i=this.value;return this.checked&&!a3.data.social_uid["qqt"==i?"qq":i]?void q(i):void 0}var w=aA(aW["dialog-reposts"]({post:u.toJSON(),repostMessage:g,service:d})),b=w.el.find("form");return b.submit(f),b.find(".ds-actions [type=checkbox]").change(p),P(b.find("textarea")).keyup(J).keyup(Q).focus(),!1}function j(g){var d={"unread-comments":{title:"新留言及回复",apiUrl:"users/unreadComments",tmpl:function(i){return i.thread?'<li data-thread-id="'+i.thread.thread_id+'">'+D.map(i.authors,aW.userAnchor).join("、")+' 在 <a class="ds-read" href="'+i.thread.url+'#comments" target="_blank">'+bf(i.thread.title||"无标题")+'</a> 中回复了你 <a class="ds-delete ds-read" title="知道了" href="javascript:void(0)">知道了</a></li>':""},read:function(l){var i=l.attr("data-thread-id");aj.post("threads/read",{thread_id:i}),aJ.data.comments--}},"unread-notifications":{title:"系统消息",apiUrl:"users/unreadNotifications",tmpl:function(i){return'<li data-notification-id="'+i.notification_id+'" data-notification-type="'+i.type+'">'+i.content+' <a class="ds-delete ds-read" title="知道了" href="javascript:void(0)">知道了</a></li>'},read:function(l){var i=l.attr("data-notification-id");aj.post("notifications/read",{notification_id:i}),aJ.data.notifications--}}}[g],f=aA("<h2>"+d.title+'</h2><ul class="ds-unread-list"></ul>');f.on("close",ai.resetNotify);var b=f.el.find(".ds-unread-list").delegate(".ds-delete","click",function(){return D(this).parent().remove(),0===b.children().length&&f.close(),!1}).delegate(".ds-read","click",function(){d.read(D(this).parent())});D("#ds-notify").hide(),aj.get(d.apiUrl,{},function(i){f.el.find(".ds-unread-list").html(D.map(i.response,d.tmpl).join("\n"))})}function m(){bubbleOutTimer&&(clearTimeout(bubbleOutTimer),bubbleOutTimer=0)}function r(){bubbleOutTimer=setTimeout(function(){bubbleOutTimer=0,c.detach()},400)}function E(f,b,d){return f.find(".ds-post[data-post-id="+b.data.post_id+"]")[0]?void 0:(f.find(".ds-post-placeholder").remove(),D(aW.post({post:b.toJSON(),options:d})).hide()["asc"==d.order?"appendTo":"prependTo"](f).slideDown(function(){}))}function h(A,K){function N(){if(aU()){return v(),!1}var n=D(this).parent(),i=n.hasClass("ds-post-liked"),l=D(this).html().match(/\((\d+)\)/),d=(l?parseInt(l[1]):0)+(i?-1:1);return aj.post("posts/vote",{post_id:n.closest(".ds-ctx-entry, .ds-post-self").attr("data-post-id"),vote:i?0:1}),D(this).html(D(this).html().replace(/\(\d+\)/,"")+(d?"("+d+")":"")),n[i?"removeClass":"addClass"]("ds-post-liked"),!1}function H(){var i=D(this).closest(".ds-post-self"),d=aI[i.attr("data-post-id")];return s(d,""),!1}function x(){if(!confirm("确定要删除这条评论吗？")){return !1}var d=D(this).closest(".ds-post-self");return aj.post("posts/remove",{post_id:d.attr("data-post-id")}),d.parent().fadeOut(200,function(){A.data.comments--,A.updateCounter("duoshuo"),D(this).remove()}),!1}function g(){if(!confirm("确定要举报这条评论吗？")){return !1}var d=D(this).closest(".ds-post-self");return aj.post("posts/report",{post_id:d.attr("data-post-id")}),alert("感谢您的反馈！"),!1}function f(){var n=D(this),d=n.closest(".ds-comment-actions");if(d.hasClass("ds-reply-active")){y.el.fadeOut(200,function(){D(this).detach()}),d.removeClass("ds-reply-active")}else{var l=n.closest(".ds-ctx-entry, .ds-post-self");y?y.actionsBar.removeClass("ds-reply-active"):(y=new ax.Replybox(A),y.render(!0).el.addClass("ds-inline-replybox").detach()),y.el.find("[name=parent_id]").val(l.attr("data-post-id")),y.el.show().appendTo(n.closest(".ds-ctx-body, .ds-comment-body")).find("textarea").focus(),y.actionsBar=d.addClass("ds-reply-active"),K.max_depth<=1?y.postList=A.postList.el:(y.postList=l.siblings(".ds-children"),y.postList[0]||(y.postList=D('<ul class="ds-children"></ul>').insertAfter(l)))}return !1}function B(){function p(i){ad(i),l.append(D.map(i.response,function(u){return aW.post({post:u,options:K})}).join(""))}var n=D(this).closest(".ds-post-self"),d=n.attr("data-post-id");n.data("source");if(0!=n.attr("data-root-id")){return !1}var l=n.siblings(".ds-children");return l[0]?(l.remove(),!1):(l=D('<ul class="ds-children"></ul>').insertAfter(n),aj.get("posts/listComments",t({post_id:d}),p),!1)}function w(){var p=D(this).closest(".ds-post-self"),u=aI[p.attr("data-post-id")],d=u.data.source;if(!a3.data.social_uid["qqt"==d?"qq":d]){return void q(d)}var l=u.data.root_id,S="0"!=l?aI[l]:u,U="";if("0"!=l){var T=prepatePost(u.data).theAuthor;U=("weibo"==d?"//@"+T.name:"|| @"+T.qqt_account)+":"+u.data.message}return s(S,U,A,d),!1}function G(){var d=D(this).parent();return d.siblings().show(),d.remove(),!1}function I(){function i(){function Z(u){var n=u.response;aG[X]?aG[X].set(n):aG[X]=new aL(n),c.owner==l&&o.html(aW.userInfo(n))}a=0,c.owner=l,m();var V=d.offset(),p=A.el.offset(),T=d.innerWidth()/2,S=A.el.innerHeight()-(V.top-p.top)+6,W=V.left-p.left-35+(T>35?35:T);try{if(d.hasClass("ds-comment-context")){o.attr("id","ds-ctx-bubble").attr("data-post-id",d.attr("data-post-id")).html('<ul id="ds-ctx">'+aW.ctxPost({post:aI[d.attr("data-parent-id")].toJSON()})+'</ul><div class="ds-bubble-footer"><a class="ds-ctx-open" href="javascript:void(0);">查看对话</a></div>')}else{if(d.hasClass("ds-avatar")||d.hasClass("ds-user-name")){var U={},X=U.user_id=d.attr("data-user-id");if(!X){throw"no info"}o.attr("id","ds-user-card").attr("data-user-id",X).empty(),aG[X]?o.html(aW.userInfo(aG[X].data)):aj.get("users/profile",t(U),Z)}}c.css({bottom:S,left:W}).appendTo(A.innerEl)}catch(Y){c.detach()}}var l=this;if(bubbleOutTimer&&c.owner==l){return clearTimeout(bubbleOutTimer),void (bubbleOutTimer=0)}var d=D(l);a=setTimeout(i,200)}function b(){a?(clearTimeout(a),a=0):bubbleOutTimer||r()}var y;this.delegate("a.ds-post-likes","click",N).delegate("a.ds-post-repost","click",H).delegate("a.ds-post-delete","click",x).delegate("a.ds-post-report","click",g).delegate("a.ds-post-reply","click",f).delegate("a.ds-weibo-comments","click",B).delegate("a.ds-weibo-reposts","click",w).delegate("a.ds-expand","click",G),am.touch||this.delegate("a.ds-comment-context, .ds-avatar, .ds-user-name","mouseenter",I).delegate("a.ds-comment-context, .ds-avatar, .ds-user-name","mouseleave",b)}function t(f){var d={require:"site,visitor,nonce,lang"+(k++?"":",unread,log,extraCss"),site_ims:aM.get("ds_site_"+bc.short_name+":timestamp"),lang_ims:aM.get("ds_lang_"+bc.short_name+":timestamp"),referer:aS.referrer};bc.stylePatch&&(d.style_patch=bc.stylePatch);for(var b in d){d[b]&&(!am.ie6||encodeURIComponent(d[b]).length<200)&&(f[b]=d[b])}return f}var D=ai.jQuery,e=D(ba),z=D(aS);ba.postMessage&&(ba.addEventListener?ba.addEventListener("message",O,!1):ba.attachEvent&&ba.attachEvent("onmessage",O)),ai.scrollTo=function(d){var b=d.offset().top;(b<e.scrollTop()||b>e.scrollTop()+e.height())&&D("html, body").animate({scrollTop:b-40},200,"swing")},ai.toJSON=function(n){var f=/\r?\n/g,g=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,b=/^(?:select|textarea)/i,d=n.map(function(){return this.elements?D.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||b.test(this.nodeName)||g.test(this.type))}).map(function(u,p){var i=D(this).val();return null==i?null:D.isArray(i)?D.map(i,function(w){return{name:p.name,value:w.replace(f,"\r\n")}}):{name:p.name,value:i.replace(f,"\r\n")}}).toArray(),l={};return D.each(d,function(){l[this.name]=this.value}),l},ai.resetNotify=function(){var d=D("#ds-notify"),b=aJ.data;d[0]||(d=D('<div id="ds-notify"></div>').css({hidden:{display:"none"},"top-right":{top:"24px",right:"24px"},"bottom-right":{bottom:"24px",right:"24px"}}[aK.data.notify_position]).delegate(".ds-notify-unread a","click",function(){return j(D(this).data("type")),!1}).appendTo(aS.body)),d.html(aW.notify(b))[!b.comments&&!b.notifications||"hidden"===aK.data.notify_position||D(".ds-dialog")[0]?"hide":"show"]()},aJ.on("reset",ai.resetNotify),ax.Replybox=function(b){this.embedThread=b},ax.Replybox.prototype={render:function(W){function A(b){b.data("submitting",!0),b.find(".ds-post-button").addClass("ds-waiting").html(aB.posting)[0].disabled=!0}function Z(b){b.data("submitting",!1),b.find(".ds-post-button").removeClass("ds-waiting").html(aB.post)[0].disabled=!1}var S=this,I=S.embedThread,X=I.options,H=function(){ai.require("smilies",function(){})},U={thread:I,options:X,inline:W,params:{thread_id:I.threadId,parent_id:"",nonce:ai.nonce},repostArray:[],checked:0};for(var u in a3.data.repostOptions){a3.data.repostOptions[u]&&(U.repostArray.push(u),U.checked=1)}var V=S.el=D(aW.replybox(U)).click(H),Y=V.find("form"),f=Y.find("input[type=checkbox]")[0],at=Y.find("a.ds-service-icon, a.ds-service-icon-grey"),K=P(Y.find("textarea")).focus(H).keyup(J).keyup(Q).bind("focus mousedown mouseup keyup",C),n=V.find(".ds-add-emote").click(function(g){var b=ai.smiliesTooltip;return n.toggleClass("ds-expanded").hasClass("ds-expanded")?(b||(b=ai.smiliesTooltip=new ax.SmiliesTooltip,b.render(),ai.require("smilies",function(){b.reset("微博-默认")})),b.replybox=S,b.el.appendTo(aS.body).css({top:S.el.offset().top+S.el.outerHeight()+4+"px",left:S.el.find(".ds-textarea-wrapper").offset().left+"px"}),D(aS.body).click(l)):l(g),!1}),l=(V.find(".ds-add-image").click(function(x){var p=K[0],b=p.value,g="请输入图片地址",w='<img src="'+g+'" />';if(aS.selection){p.value=b.substring(0,K.data("ds-range-start"))+w+b.substring(K.data("ds-range-end"),b.length),p.value=p.value.replace("说点什么吧 ...",""),p.focus();var T=aS.selection.createRange();T.collapse(),T.findText(g),T.select()}else{p.value=b.substring(0,p.selectionStart)+w+b.substring(p.selectionEnd);var y=p.value.search(g);p.setSelectionRange(y,y+g.length),p.focus()}x.preventDefault()}),S.hideSmilies=function(){n.removeClass("ds-expanded"),ai.smiliesTooltip.el.detach(),D(aS.body).unbind("click",l)}),d=function(x,p){var w=aA(aW["dialog-anonymous"]({services:["weixin","weibo","qq","renren","kaixin","douban"],options:X})),b=w.el.find(".ds-dialog").css("width","320px");if(b.find(".ds-icons-32 a").click(L),!X.deny_anonymous){var g=w.el.find("form");g.submit(function(){var i=g.find("input[name=author_email]").val();return !i&&!X.require_guest_email||i.match(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)?(p(ai.toJSON(g)),w.close(),!1):(alert("请输入一个有效的email地址."),!1)}),g.find("input[name=author_name]")[0].focus()}};X.deny_anonymous&&K.focus(function(){if(aU()){d(Y,G);var b=function(g){g.stopPropagation(),K.unbind("click",b)};K.click(b)}return !1});var G=function(b){A(Y),aj.post("posts/create",D.extend(ai.toJSON(Y),b),function(w){var g=aI[w.response.post_id]=new az(w.response),i=E(S.postList,g,X);if("asc"==X.order==("top"==X.formPosition)&&ai.scrollTo(i),I.data.comments++,I.updateCounter("duoshuo"),K.val("").trigger("keyup"),Z(Y),V.hasClass("ds-inline-replybox")&&(V.detach(),S.actionsBar.removeClass("ds-reply-active")),a0){try{a0.removeItem("ds_draft_"+I.threadId)}catch(p){}}},function(g){Z(Y),alert(g.errorMessage)})};Y.submit(function(){if(Y.data("submitting")){return !1}var b=D.trim(Y[0].message.value);return""==b||!am.placeholder&&b==K.attr("placeholder")?(alert("您还没写内容呢"),!1):(aU()?d(Y,G):G(),!1)});var B=function(b){return D(b).hasClass("ds-service-icon-grey")?null:D(b).attr("data-service")};if(at.click(function(){return D(this).toggleClass("ds-service-icon-grey").toggleClass("ds-service-icon"),f.value=D.map(at,B).join(","),f.checked=""!=f.value,!1}),D(f).change(function(){var b=this.checked;at[b?"removeClass":"addClass"]("ds-service-icon-grey")[b?"addClass":"removeClass"]("ds-service-icon"),this.value=D.map(at,B).join(",")}),!W&&a0){var N="ds_draft_"+I.threadId;K.bind("focus blur keyup",function(g){var b=D(g.currentTarget).val();try{a0[N]=b}catch(g){}}),a0[N]&&K.val(a0[N])}return this}},ax.Dialog=au.extend({init:function(d,b){(this.el=D("#ds-wrapper"))[0]||(this.el=F(D('<div id="ds-wrapper"></div>'))),this.options=D.extend({width:600},b),d!==aT&&D(d).attr("id","ds-reset").appendTo(this.el)},open:function(){function f(g){return 27==g.which?(b.close(),!1):void 0}function d(){return b.close(),!1}var b=this;return b.el.hide().appendTo(aS.body).fadeIn(200),am.ie6&&b.el.css("top",e.scrollTop()+100),b.el.show().find(".ds-dialog").delegate("a.ds-dialog-close","click",function(){return b.close(),!1}).click(M),z.keydown(f),D(aS.body).click(d),b.close=function(){z.unbind("keydown",f),D(aS.body).unbind("click",d),b.el.fadeOut(200,function(){D(this).remove()}),b.trigger("close")},b}}),aW.likePanel=function(b){return b.likes?'<span class="ds-highlight">'+b.likes+"</span> 人喜欢":""},ax.Meta=function(b){this.embedThread=b},ax.Meta.prototype={render:function(){function f(d){function w(u){i.set(u),p.resetLikePanel()}function A(){p.tooltip.detach(),D(aS.body).unbind("click",A)}function l(u){switch(this.className){case"ds-like-tooltip-close":A(u);break;default:if(!ba.open(this.href,"_blank","height=500,width=600,top=0,left=0,toolbar=no,menubar=no,resizable=yes,location=yes,status=no")){return}}return !1}var y=b.hasClass("ds-thread-liked");if(aj.post("threads/vote",{thread_id:p.embedThread.threadId,vote:y?0:1},w),b.toggleClass("ds-thread-liked"),b.find(".ds-thread-like-text").text(y?"喜欢":"已喜欢"),y){return p.tooltip&&A(d),!1}if(p.tooltip===aT){var n=aW.likeTooltip({services:{qzone:"QQ空间",weibo:"新浪微博",qqt:"腾讯微博",renren:"人人网",kaixin:"开心网",douban:"豆瓣网",baidu:"百度搜藏"},thread_id:i.data.thread_id});p.tooltip=D(n).click(M).delegate("a","click",l)}var x={};return x.left=0,x.top=g.position().top+g.outerHeight()-4+"px",p.tooltip.appendTo(p.embedThread.innerEl).css(x),D(aS.body).click(A),!1}var p=this,i=p.embedThread.model,g=p.el=D(aW.meta(i.toJSON())),b=g.find(".ds-like-thread-button");return b.click(f),p.resetLikePanel(),aU()&&g.hide(),p},resetLikePanel:function(){this.el.find(".ds-like-panel").html(aW.likePanel(this.embedThread.model.toJSON()))}},ax.PostListHead=function(b){this.embedThread=b},ax.PostListHead.prototype={render:function(){function p(n){l.find("a.ds-current").removeClass("ds-current"),b.params.page=1;var i=n.currentTarget;switch(i.className){case"ds-comments-tab-duoshuo":b.params.source="duoshuo",g.replybox.el.show();break;case"ds-comments-tab-repost":b.params.source="repost",g.replybox.el.hide();break;case"ds-comments-tab-weibo":b.params.source="weibo",g.replybox.el.hide();break;case"ds-comments-tab-qqt":b.params.source="qqt",g.replybox.el.hide()}return D(i).addClass("ds-current"),b.refetch(),!1}function f(){return u.find("a.ds-current").removeClass("ds-current"),b.params.order=g.options.order=this.className.replace("ds-order-",""),b.params.page=1,b.refetch(),D(this).addClass("ds-current"),!1}var g=this.embedThread,b=g.postList,d=this.el=D(aW.postListHead({thread:g.model.toJSON(),options:g.options})),l=d.find("ul.ds-comments-tabs");l.delegate(".ds-tab a","click",p);var u=d.find(".ds-sort");return u.delegate("a","click",f),u.find(".ds-order-"+b.params.order).addClass("ds-current"),this}},ax.Paginator=function(l){function f(){return d.params.page=parseInt(this.innerHTML),d.refetch(),b.find(".ds-current").removeClass("ds-current"),D(this).addClass("ds-current"),!1}l=l||{};var g=this,b=g.el=l.el||D('<div class="ds-paginator"></div>'),d=g.collection=l.collection;b.delegate("a","click",f)},ax.Paginator.prototype={reset:function(l){function f(i){d.push('<a data-page="'+i+'" href="javascript:void(0);">'+i+"</a>")}var g,b=this.collection.params.page||1,d=[];if(b>1){for(f(1),g=b>4?b-2:2,g>2&&d.push('<span class="page-break">...</span>');b>g;g++){f(g)}}if(d.push('<a data-page="'+b+'" href="javascript:void(0);" class="ds-current">'+b+"</a>"),b<l.pages){for(g=b+1;b+4>=g&&g<l.pages;g++){f(g)}g<l.pages&&d.push('<span class="page-break">...</span>'),f(l.pages)}this.el.html('<div class="ds-border"></div>'+d.join(" "))[l.pages>1?"show":"hide"]()}},ai.addSmilies=function(f,b){var d=ai.smiliesTooltip;d&&d.el.find("ul.ds-smilies-tabs").append("<li><a>"+f+"</a></li>"),ai.smilies[f]=b},ax.SmiliesTooltip=function(){},ax.SmiliesTooltip.prototype={render:function(){function f(){var u=d.replybox,g=u.el.find("textarea"),l=g[0],p=l.value;if(aS.selection){l.value=p.substring(0,g.data("ds-range-start"))+this.title+p.substring(g.data("ds-range-end"),p.length),l.value=l.value.replace(aB.leave_a_message,""),l.focus();var x=aS.selection.createRange();x.moveStart("character",g.data("ds-range-start")+this.title.length),x.collapse(),x.select()}else{var w=l.selectionStart+this.title.length;l.value=p.substring(0,l.selectionStart)+this.title+p.substring(l.selectionEnd),l.setSelectionRange(w,w)}u.hideSmilies(),l.focus()}var d=this,b=d.el=D(aW.smiliesTooltip(aq));return b.click(M).find("ul.ds-smilies-tabs").delegate("a","click",function(){d.reset(this.innerHTML)}),b.find(".ds-smilies-container").delegate("img","click",f),this},reset:function(g){function d(n,p){var l=0===g.indexOf("微博")?"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/"+p.replace("_org","_thumb"):ai.STATIC_URL+"/images/smilies/"+p;"WordPress"===g&&(n=" "+n+" "),b+='<li><img src="'+l+'" title="'+bf(n)+'" /></li>'}var f=this.el.find("ul.ds-smilies-tabs");f.find("a.ds-current").removeClass("ds-current"),f.find("a").filter(function(){return this.innerHTML==g}).addClass("ds-current");var b="<ul>";return D.each(aq[g],d),b+="</ul>",this.el.find(".ds-smilies-container").html(b),this}},aW.postPlaceholder=function(){return['<li class="ds-post ds-post-placeholder">',aB.no_comments_yet,"</li>"].join("")};var c=D('<div id="ds-bubble"><div class="ds-bubble-content"></div><div class="ds-arrow ds-arrow-down ds-arrow-border"></div><div class="ds-arrow ds-arrow-down"></div></div>'),o=c.find(".ds-bubble-content").delegate("a.ds-ctx-open","click",function(){function f(i){function g(n,l){return aW.ctxPost({post:n,index:l})}aC.log(D.map(i.response,g).join("\n"));d.el.find("ol");d.el.find("ol").html(D.map(i.response,g).join("\n"))}var b={};b.post_id=o.attr("data-post-id"),aj.get("posts/conversation",b,f);var d=aA('<h2>查看对话</h2><ol id="ds-ctx"></ol>');return d.el.find(".ds-dialog").css("width","600px"),d.el.find(".ds-dialog-body").css({"max-height":"350px",_height:"350px","overflow-y":"auto","padding-top":"10px"}),!1}),a=bubbleOutTimer=0;c.mouseenter(m).mouseleave(r),ax.PostList=function(b){b&&(b.params&&(this.params=b.params),b.embedThread&&(this.embedThread=b.embedThread)),this.el=D('<ul class="ds-comments"></ul>')},ax.PostList.prototype={url:"threads/listPosts",render:function(){return h.call(this.el,this.embedThread,this.embedThread.options),this},reset:function(d){var b=this.embedThread.options;this.el.html(d[0]?D.map(aI.getJSON(d),function(f){return aW.post({post:f,options:b})}).join(""):aW.postPlaceholder())},refetch:function(){function f(g){aI.set(g.parentPosts||g.relatedPosts),aG.set(g.users),d.reset(g.response),d.embedThread.paginator.reset(g.cursor),d.el.fadeTo(200,1),ai.scrollTo(d.el),b.remove()}var d=this,b=D(aW.indicator()).appendTo(aS.body).fadeIn(200);d.el.fadeTo(200,0.5),aj.get(d.url,d.params,f)}},ax.RelatedRead=function(){this._init()},ax.RelatedRead.prototype={uri:"base/recommend",mountedSelectorLists:[".detail_main .detail_con .d_img p:last",".jun4_article .jun4_cententttt"],_init:function(){this.el=D('<div id="ds-related-reads"></div>'),this._count_timer=null},_unpackImages:function(g){for(var d,f=g.image_list.slice(0,3),b=[];f.length;){d=f.shift(),b.push(d.medium_image)}return b},_transform:function(g){for(var d=[],f=0,b=g.length;b>f;f++){d.push({url:g[f].url,title:g[f].title,type:g[f].type,source:g[f].source,imgs:this._unpackImages(g[f]),timeStamp:1000*g[f].publish_time,hasVideo:g[f].has_video,videoDuration:this._parseVideoDuration(g[f].video_duraion)})}return d},_parseVideoDuration:function(g){g=+g;var d=Math.floor(g/3600),f=Math.floor((g-60*d*60)/60),g=g-60*d*60-60*f,b=""+(d?(10>d?"0"+d:d)+" : ":"")+(10>f?"0"+f:f)+" : "+(10>g?"0"+g:g);return b},load:function(d){var b=this;aj.get(this.uri,{thread_id:d,url:a6.href},function(f){0==f.code?b.render(f.response):b.renderError()})},mount:function(f){var b=D(this.mountedSelectorLists.join(","));if(b.length){try{return void this.el.insertAfter(b)}catch(d){}}f.append(this.el)},renderError:function(){},render:function(f){this.el.html(aW["related-read"](this._transform(f)));try{this.count()}catch(b){}if(typeof ander!=="undefined"&&ander.route.showID){var d=ander(ander.route.showID);d&&d.scrollIntoView&&d.scrollIntoView()}},count:function(){var d=this;!function b(){clearTimeout(d._count_timer),d.el.find(".ds-reads-date").each(function(){var x,B,G,A,w,f,p=D(this).data("date"),g=(new Date).getTime(),y=g-p,u=new Date(p);y>86400000?(x=u.getFullYear(),B=u.getMonth()+1,G=u.getDate(),D(this).html(x+"年"+B+"月"+G+"日")):y>3600000?(A=Math.floor(y/60/60/1000),D(this).html(A+"小时前")):y>60000?(w=Math.floor(y/60/1000),D(this).html(w+"分钟前")):(f=Math.floor(y/1000),D(this).html(f+"秒前"))}),d._count_timer=setTimeout(b,60000)}()},stopCount:function(){clearTimeout(this._count_timer)}},ax.EmbedThread=al.extend({uri:"threads/listPosts",params:"thread-id local-thread-id source-thread-id thread-key category channel-key author-key author-id url limit order max-depth form-position container-url"+(aQ.match(/MSIE 6\.0/)?"":" title image thumbnail"),render:function(){var f=this.el;f.attr("id","ds-thread").append(aW.waitingImg());var b=f.width(),d=f.data("url")||!f.attr("data-thread-id")&&D("link[rel=canonical]").attr("href");d?f.data("url",a2(d)):f.data("container-url",a6.href),b&&400>=b&&f.addClass("ds-narrow").data("max-depth",1)},updateCounter:function(l){function f(i){return i.substr(i.indexOf("}")+1)}var g={duoshuo:["comments",f(aB.comments_multiple)||"评论"],repost:["reposts",f(aB.reposts_multiple)||"转载"],weibo:["weibo_reposts",f(aB.weibo_reposts_multiple)||"新浪微博"],qqt:["qqt_reposts",f(aB.qqt_reposts_multiple)||"腾讯微博"]};for(var b in g){if(!l||l==b){var d=this.data[g[b][0]];this.el.find(".ds-comments-tab-"+b).html(this.el.hasClass("ds-narrow")?'<span class="ds-service-icon ds-'+b+'"></span>'+d:(d?'<span class="ds-highlight">'+d+"</span>":"0")+g[b][1])}}},onError:function(b){this.el.html("评论框出错啦("+b.code+"): "+b.errorMessage)},onload:function(l){var b=this,g=b.threadId=l.thread.thread_id,y=l.cursor,w=b.options=l.options,p=b.innerEl=F(D('<div id="ds-reset"></div>').appendTo(b.el));b.model=new ab(b.data=l.thread),aI.set(l.parentPosts||l.relatedPosts),aG.set(l.users),b.el.find("#ds-waiting").remove(),l.options&&l.options.show_recommend&&(b.relatedRead=new ax.RelatedRead,b.relatedRead.load(l.thread.thread_id),b.relatedRead.mount(p)),w.like_thread_enabled&&(b.meta=new ax.Meta(b),p.append(b.meta.render().el)),w.hot_posts&&l.hotPosts&&l.hotPosts.length&&(b.hotPosts=new ax.HotPosts(D('<div class="ds-rounded"></div>'),{max_depth:1,show_context:w.show_context}),b.hotPosts.thread=b,p.append(b.hotPosts.el),b.hotPosts.onload({list:aI.getJSON(l.hotPosts)})),b.postListHead=new ax.PostListHead(b),b.postList=new ax.PostList({embedThread:b,params:{source:"duoshuo",thread_id:g,max_depth:w.max_depth,order:w.order,limit:w.limit}}),b.postList.render().reset(l.response),b.paginator=new ax.Paginator({collection:b.postList}),b.paginator.reset(y);var x=b.replybox=new ax.Replybox(b);x.postList=b.postList.el,aU()?b.loginButtons=D(aW.loginButtons()).delegate("a.ds-more-services","click",function(){return b.loginButtons.find(".ds-additional-services").toggle(),!1}).delegate("a.ds-service-link","click",L):b.toolbar=D(aW.toolbar()).delegate(".ds-account-control","mouseenter",function(){D(this).addClass("ds-active")}).delegate(".ds-account-control","mouseleave",function(){D(this).removeClass("ds-active")}).delegate("a.ds-bind-more","click",function(){var d=aA(aW["dialog-bind-more"]()).el.find(".ds-dialog").addClass("ds-dialog-bind-more").css("width","300px");return d.find("a.ds-service-link").click(L),!1}).delegate("a.ds-unread-comments-count","click",function(){return j("unread-comments"),!1});var f=['<a name="respond"></a>',b.toolbar||b.loginButtons,x.render().el];"top"==w.formPosition&&D.fn.append.apply(p,f),p.append(b.postListHead.render().el,b.postList.el,b.paginator.el),"bottom"==w.formPosition&&D.fn.append.apply(p,f),p.append(aW.poweredBy(w.poweredby_text)),b.updateCounter(),l.alerts&&D.each(l.alerts,function(i,d){D('<div class="ds-alert">'+d+"</div>").insertBefore(b.toolbar||loginButtons)}),w.message&&x.el.find("textarea").val(w.message).focus(),aJ.on("reset",function(){var d=aJ.data.comments||0;p.find("a.ds-unread-comments-count").html(d).attr("title",d?"你有"+d+"条新回复":"你没有新回复").css("display",d?"inline":"none")}),w.mzadx_id&&(ai.require("mzadxN",function(){}),D('<div id="MZADX_'+w.mzadx_id+'" style="margin:0 auto;"></div>').appendTo(p),__mz_rpq=ba.__mz_rpq||[],__mz_rpq.push({l:[w.mzadx_id],r:"1",_srv:"MZADX",_callback:function(){}})),ai.thread=b,aJ.data!==aT&&aJ.trigger("reset"),aU()||ap.send({visit_thread_id:b.threadId})},onMessage:function(b){E(this.postList.el,new az(b),this.options)}}),ax.HotPosts=al.extend({tmpl:"hotPosts",params:"show-quote",render:function(){return this.el.attr("id","ds-hot-posts"),this},onload:function(b){b.options=D.extend(this.options,b.options),al.prototype.onload.call(this,b),h.call(this.el.find("ul"),this.thread,this.options)}}),ax.RecentComments=al.extend({tmpl:"commentList",uri:"sites/listRecentPosts",params:"show-avatars show-time show-title avatar-size show-admin excerpt-length num-items channel-key",render:function(){this.el.attr("id","ds-recent-comments")},prepare:function(b){return{list:D.map(b.response,function(d){return new az(d).toJSON()})}}}),ax.RecentVisitors=al.extend({tmpl:"recentVisitors",uri:"sites/listVisitors",params:"show-time avatar-size num-items channel-key",render:function(){this.el.children().detach(),this.el.attr("id","ds-recent-visitors").append(this.waitingEl=D(aW.waitingImg()))}}),ax.TopThreads=al.extend({tmpl:"topThreads",uri:"sites/listTopThreads",params:"range num-items channel-key",render:function(){this.el.children().detach(),this.el.attr("id","ds-top-threads").append(this.waitingEl=D(aW.waitingImg()))}}),ax.LoginWidget=al.extend({tmpl:"loginWidget",render:function(){var b=this.el;b.attr("id","ds-login").html(aW.loginWidget(["weixin","weibo","qq","renren","kaixin","douban"])),b.find("a").click(L),b.find("a.ds-logout").attr("href",aa.logoutUrl())}}),ax.ThreadCount=al.extend({onload:function(g){var d=this.el,f=d.data("count-type")||"comments",b=g.data[f];d[d.data("replace")?"replaceWith":"html"](aB[f+"_"+(b?b>1?"multiple":"one":"zero")].replace("{num}",b))}}),ax.ShareWidget=al.extend({tmpl:"shareWidget",render:function(){var b={copyright:"分享插件",services:["weibo","qzone","sohu","renren","netease","qqt","kaixin","douban","qq","meilishuo","mogujie","baidu","taobao","google","wechat","diandian","huaban","duitang","youdao","pengyou","facebook","twitter","linkedin","msn"]};this.el.attr("id","ds-share"),this.el.children().attr("id","ds-reset"),this.el.find(".ds-share-aside-inner").html(aW.shareWidget(b)),this.el.find(".ds-share-icons-more").html(aW.shareWidget(b)),this.el.find(".ds-share-icons-more").hide(),this.el.hasClass("flat")&&this.el.find("a").each(function(){D(this).addClass("flat")}),F(this.el),this.delegateEvents()},delegateEvents:function(){var p=this,g=p.el;if(g.children().hasClass("ds-share-inline")){var w=".ds-share-icons-more",A=g.find(w),x="[data-toggle=ds-share-icons-more]";g.delegate(x,"mouseover",function(){A.show()}),g.delegate(x,"mouseout",function(){A.hide()}),g.delegate(w,"mouseover",function(){A.show()}),g.delegate(w,"mouseout",function(){A.hide()})}else{var b=g.children().hasClass("ds-share-aside-left")?"slide-to-right":"slide-to-left",y=g.children();if(!aY.cssProperty("transition")){var f=g.children().hasClass("ds-share-aside-left")?"left":"right";g.delegate(".ds-share-aside-toggle","mouseover",function(){var i={},d=am.ie6&&"right"===f;d?i.left=(aS.documentElement.scrollLeft+aS.documentElement.clientWidth-this.offsetWidth-(parseInt(this.currentStyle.marginLeft,10)||0)-parseInt(this.currentStyle.marginRight,10)||0)-195:i[f]=0,y.animate(i,200)}),g.delegate(".ds-share-aside-inner","mouseleave",function(){var i={},d=am.ie6&&"right"===f;d?i.left=(aS.documentElement.scrollLeft+aS.documentElement.clientWidth-this.offsetWidth-(parseInt(this.currentStyle.marginLeft,10)||0)-parseInt(this.currentStyle.marginRight,10)||0)+230:i[f]=-229,y.animate(i,200)})}g.delegate(".ds-share-aside-toggle,.ds-share-aside-inner","mouseover",function(){y.addClass(b)}),g.delegate(".ds-share-aside-toggle,.ds-share-aside-inner","mouseleave",function(){y.removeClass(b)})}g.delegate("a","click",function(u){var B=D(this).data("service");if(!g.data("url")){return void alert("请设置data-url")}if("wechat"===B){var G=be()+"/api/qrcode/getImage.png",I="?size=240&text="+g.data("url"),H=aA(aW["dialog-qrcode"]({qrcode_url:G+I,url:g.data("url")}));H.el.find(".ds-dialog").css("width","320px")}else{var i=be()+"/share-proxy/?"+aY.param({service:D(this).data("service"),thread_key:g.data("threadKey"),title:g.data("title"),images:g.data("images"),content:g.data("content"),url:g.data("url")});ba.open(i,"_blank")}u.preventDefault(),u.stopPropagation()})}});var k=0;ai.initSelector=function(g,d){function f(i){ad(i),aY.extend(aB,i.options),ak.set(i.response)}var b=[];!aV()||!D.isReady&&a4||D(g).each(function(w,p){var l=D(p);if(!l.data("initialized")){l.data("initialized",!0);var u=new ax[d.type](l,d);if(ah.push(u),"ThreadCount"===d.type){var y=l.attr("data-thread-key");l.attr("data-channel-key")&&(y=l.attr("data-channel-key")+":"+y),b.push(y),ak[y]||(ak[y]=new ab({})),ak[y].on("reset",function(){u.onload(this)})}else{if(u.uri){var x={};D.each(u.params.split(" "),function(n,i){x[i.replace(/-/g,"_")]=l.attr("data-"+i)||l.data(i)}),aj.get(u.uri,t(x),function(i){u.load(i)})}}}}),b.length&&aj.get("threads/counts",t({threads:b.join(",")}),f)},(ai.initView=function(){D.each(an,ai.initSelector)})(),D(function(){setInterval(function(){D(".ds-time").each(function(){var b=D(this).attr("datetime");b&&(this.innerHTML=ai.elapsedTime(b))})},20000),bc.ondomready&&bc.ondomready(),ai.initView(),!k&&bc.short_name&&aj.get("analytics/ping",t({}),ad)})})}}(window,document);